<script>
    (function () {
        const urlParams = new URLSearchParams(window.location.search);
        const xmlUrl = urlParams.get('xml');

        if (!xmlUrl) {
            throw new Error('请指定XML文件路径: 在URL后添加 ?xml=你的xml文件地址');
        }

        fetch(xmlUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status} - 无法加载XML文件`);
                }
                return response.text();
            })
            .then(xmlText => {
                const xmlDoc = new DOMParser().parseFromString(xmlText, 'text/xml');

                // 检查解析错误
                const parseError = xmlDoc.querySelector('parsererror');
                if (parseError) {
                    throw new Error('XML解析失败: ' + parseError.textContent);
                }

                // 直接通过标签名取，无视任何层级和命名空间
                const links = Array.from(xmlDoc.getElementsByTagName('originalWiki'))
                    .map(node => node.textContent.trim())
                    .filter(url => url && url.startsWith('http'));

                if (links.length === 0) {
                    throw new Error('XML中未找到任何originalWiki链接');
                }

                // 随机跳转
                window.location.href = links[Math.floor(Math.random() * links.length)];
            })
            .catch(error => {
                console.error('XML随机跳转失败:', error);
                alert('错误: ' + error.message);
            });
    })();
</script>